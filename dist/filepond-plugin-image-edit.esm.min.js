/*!
 * FilePondPluginImageEdit 1.1.4
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

const t=t=>/^image/.test(t.type),e=e=>{const{addFilter:i,utils:o,views:n}=e,{Type:E,createRoute:r,createItemAPI:l=(t=>t)}=o,{fileActionButton:d}=n;i("SHOULD_REMOVE_ON_REVERT",(e,{item:i,query:o})=>new Promise(e=>{const{file:n}=i;e(!(o("GET_ALLOW_IMAGE_PREVIEW")&&o("GET_ALLOW_IMAGE_EDIT")&&o("GET_IMAGE_EDIT_ALLOW_EDIT")&&t(n)))})),i("DID_LOAD_ITEM",(e,{query:i,dispatch:o})=>new Promise((n,E)=>{if(e.origin>1)return void n(e);const{file:r}=e;if(!i("GET_ALLOW_IMAGE_PREVIEW")||!i("GET_ALLOW_IMAGE_EDIT")||!i("GET_IMAGE_EDIT_INSTANT_EDIT"))return void n(e);if(!t(r))return void n(e);const l=(t,e,i)=>n=>{a.shift(),n?e(t):i(t),o("KICK"),d()},d=()=>{if(!a.length)return;const{item:t,resolve:e,reject:i}=a[0];o("EDIT_ITEM",{id:t.id,handleEditorResponse:l(t,e,i)})};I({item:e,resolve:n,reject:E}),1===a.length&&d()})),i("DID_CREATE_ITEM",(t,{query:e,dispatch:i})=>{t.extend("edit",()=>{i("EDIT_ITEM",{id:t.id})})});const a=[],I=t=>(a.push(t),t);return i("CREATE_VIEW",e=>{const{is:i,view:o,query:n}=e;if(!i("file")||!n("GET_ALLOW_IMAGE_PREVIEW")||!n("GET_ALLOW_IMAGE_EDIT"))return;const E=n("GET_IMAGE_EDIT_EDITOR");if(!E)return;E.outputData=!0,E.outputFile=!1,E.cropAspectRatio=n("GET_IMAGE_CROP_ASPECT_RATIO")||E.cropAspectRatio,E.filepondCallbackBridge||(E.filepondCallbackBridge={onconfirm:E.onconfirm||(()=>{}),oncancel:E.oncancel||(()=>{})});o.registerDestroyer(({root:t})=>{t.ref.buttonEditItem&&t.ref.buttonEditItem.off("click",t.ref.handleEdit)}),o.registerWriter(r({DID_IMAGE_PREVIEW_SHOW:({root:t})=>{t.ref.buttonEditItem&&(t.ref.buttonEditItem.opacity=1)},DID_LOAD_ITEM:({root:e,props:i})=>{if(!n("GET_IMAGE_EDIT_ALLOW_EDIT"))return;const{id:E}=i,r=n("GET_ITEM",E);if(!r)return;const l=r.file;if(!t(l))return;const a=o.createChildView(d,{label:"edit",icon:n("GET_IMAGE_EDIT_ICON_EDIT"),opacity:0});a.element.classList.add("filepond--action-edit-item"),a.element.dataset.align=n("GET_STYLE_IMAGE_EDIT_BUTTON_EDIT_ITEM_POSITION"),e.ref.handleEdit=(t=>{t.stopPropagation(),e.dispatch("EDIT_ITEM",{id:E})}),a.on("click",e.ref.handleEdit),e.ref.buttonEditItem=o.appendChildView(a)},EDIT_ITEM:({root:t,props:e,action:i})=>{const{id:o}=e,{handleEditorResponse:n}=i,r=t.query("GET_ITEM",o);if(!r)return;const d=r.file,a={crop:r.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null}};E.onconfirm=(({data:t})=>{const{crop:e}=t;r.setMetadata({crop:e}),E.filepondCallbackBridge.onconfirm(t,l(r)),n&&(E.onclose=(()=>{n(!0),E.onclose=null}))}),E.oncancel=(()=>{E.filepondCallbackBridge.oncancel(l(r)),n&&(E.onclose=(()=>{n(!1),E.onclose=null}))}),E.open(d,a)}}))}),{options:{allowImageEdit:[!0,E.BOOLEAN],styleImageEditButtonEditItemPosition:["bottom center",E.STRING],imageEditInstantEdit:[!1,E.BOOLEAN],imageEditAllowEdit:[!0,E.BOOLEAN],imageEditIconEdit:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M8.5 17h1.586l7-7L15.5 8.414l-7 7V17zm-1.707-2.707l8-8a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1 0 1.414l-8 8A1 1 0 0 1 10.5 19h-3a1 1 0 0 1-1-1v-3a1 1 0 0 1 .293-.707z" fill="currentColor" fill-rule="nonzero"/></svg>',E.STRING],imageEditEditor:[null,E.OBJECT]}}};"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:e}));export default e;
